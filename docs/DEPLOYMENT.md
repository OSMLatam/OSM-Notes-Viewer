# Deployment Guide

This document describes how to deploy OSM Notes Viewer to various platforms.

## Prerequisites

- The data JSON files generated by OSM-Notes-Analytics
- A web hosting platform (Netlify, Vercel, GitHub Pages, etc.)

## Option 1: Netlify (Recommended)

Netlify is the easiest option with great features for static sites.

### Steps:

1. **Connect Repository**
   - Go to https://app.netlify.com/
   - Click "New site from Git"
   - Connect your GitHub account
   - Select the `OSM-Notes-Viewer` repository

2. **Configure Build Settings**
   - Build command: (leave empty for static site)
   - Publish directory: `src`
   - Click "Deploy site"

3. **Configure Data Endpoint**
   - Update `config/api-config.js` with your JSON files location
   - Example: `BASE_URL: 'https://your-data-cdn.com/api'`

4. **Custom Domain** (optional)
   - Go to Domain settings
   - Add your custom domain
   - Configure DNS as instructed

### Continuous Deployment:
Every push to `main` branch automatically deploys.

---

## Option 2: Vercel

Similar to Netlify, great for static sites.

### Steps:

1. Install Vercel CLI: `npm i -g vercel`
2. Run: `vercel` in project directory
3. Follow prompts
4. Configure `config/api-config.js` with data endpoint

---

## Option 3: GitHub Pages

Free hosting directly from your GitHub repository.

### Steps:

1. **Enable GitHub Pages**
   - Go to repository Settings
   - Navigate to Pages
   - Source: Deploy from branch
   - Branch: `main`, Folder: `/src`
   - Save

2. **Access your site**
   - Available at: `https://angoca.github.io/OSM-Notes-Viewer/`

3. **Configure API endpoint**
   - Update `config/api-config.js`
   - Use relative path or absolute URL to JSON files

### Using GitHub Actions (Optional):

Create `.github/workflows/deploy.yml`:

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./src
```

---

## Option 4: Cloudflare Pages

Fast CDN with global distribution.

### Steps:

1. Go to https://pages.cloudflare.com/
2. Connect your GitHub repository
3. Configure:
   - Build command: (none)
   - Build output: `src`
4. Deploy

---

## Data Hosting Options

Your JSON data files can be hosted separately:

### Option A: Same Repository

```
OSM-Notes-Viewer/
└── src/
    └── data/
        ├── metadata.json
        ├── indexes/
        └── users/
```

Update `config/api-config.js`:
```javascript
BASE_URL: './data'
```

### Option B: Separate CDN

Host JSON files on:
- AWS S3 + CloudFront
- Google Cloud Storage
- Azure Blob Storage
- Any CDN

Update `config/api-config.js`:
```javascript
BASE_URL: 'https://your-cdn.com/api'
```

### Option C: GitHub Pages (Data Only)

Create a separate branch for data:
```bash
git checkout --orphan gh-pages-data
git rm -rf .
# Copy JSON files
git add .
git commit -m "Data files"
git push origin gh-pages-data
```

---

## Syncing Data from Analytics

### Manual Sync

```bash
# On the analytics server
cd /path/to/OSM-Notes-Analytics
./bin/dwh/exportDatamartsToJSON.sh

# Copy to viewer
rsync -av output/json/ /path/to/OSM-Notes-Viewer/src/data/

# Commit and push
cd /path/to/OSM-Notes-Viewer
git add src/data/
git commit -m "Update data"
git push
```

### Automated Sync (Cron)

```bash
# /etc/cron.d/osm-notes-sync
*/15 * * * * user /path/to/sync-data.sh
```

**sync-data.sh:**
```bash
#!/bin/bash
cd /path/to/OSM-Notes-Analytics
./bin/dwh/exportDatamartsToJSON.sh

cd /path/to/OSM-Notes-Viewer
cp -r /path/to/OSM-Notes-Analytics/output/json/* src/data/
git add src/data/
git commit -m "Auto-update data $(date)"
git push
```

---

## Performance Optimization

### Enable Compression

Most platforms enable gzip automatically. Verify:
- Netlify: Automatic
- Vercel: Automatic
- Cloudflare: Automatic
- GitHub Pages: Check settings

### Caching Headers

**Netlify (_headers file):**
```
/data/*
  Cache-Control: public, max-age=900
```

**Vercel (vercel.json):**
```json
{
  "headers": [
    {
      "source": "/data/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=900"
        }
      ]
    }
  ]
}
```

---

## CORS Configuration

If data is hosted separately, enable CORS:

### S3 Bucket CORS:
```json
[
  {
    "AllowedHeaders": ["*"],
    "AllowedMethods": ["GET"],
    "AllowedOrigins": ["*"],
    "ExposeHeaders": []
  }
]
```

---

## Monitoring

### Netlify Analytics
- Enable in site settings
- View traffic and performance

### Google Analytics (Optional)

Add to `index.html`:
```html
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_ID"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'YOUR_ID');
</script>
```

---

## Troubleshooting

### CORS Errors
- Check data endpoint CORS headers
- Use relative paths if possible
- Configure CORS on data CDN

### 404 on Refresh
- Configure redirects to `index.html`
- Netlify: Create `_redirects` file: `/*  /index.html  200`

### Slow Loading
- Check JSON file sizes
- Enable compression
- Use CDN for data files
- Implement lazy loading

---

## Security

- No sensitive data (all public OSM data)
- No authentication needed
- Enable HTTPS (automatic on all platforms)
- Consider rate limiting for API if needed

---

## Cost Estimates

- **Netlify**: Free for most use cases
- **Vercel**: Free tier sufficient
- **GitHub Pages**: Completely free
- **Cloudflare Pages**: Free tier generous

For high traffic, all have affordable paid tiers.


